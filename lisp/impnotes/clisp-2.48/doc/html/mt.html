<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>32.5. Multiple Threads of Execution</title><link rel="stylesheet" href="impnotes.css" type="text/css" /><link rev="made" href="mailto:clisp-list@lists.sourceforge.net" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_8465" /><link rel="home" href="index.html" title="Implementation Notes for GNU CLISP" /><link rel="up" href="ext-platform.html" title="Chapter 32. Platform Specific Extensions" /><link rel="prev" href="socket.html" title="32.4. Socket Streams" /><link rel="next" href="quickstart.html" title="32.6. Quickstarting delivery with CLISP" /><link rel="copyright" href="legalese.html" title="Legal Status of the CLISP Implementation Notes" /><meta name="date" content="'generated: 2009-07-28 12:48:49-04:00'" /><link rel="author" title="Authors" href="index.html#authors" /><link rel="contents" title="Table of Contents" href="index.html" /><link rel="glossary" href="glossary.html" /><link rel="help" href="faq.html#faq-help" title="How do I ask for help?" /><link rel="home" title="Home" href="http://clisp.cons.org" /><link rel="index" href="idx.html" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">32.5. Multiple Threads of Execution</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="socket.html">Prev</a> </td><th width="60%" align="center">Chapter 32. Platform Specific Extensions</th><td width="20%" align="right"> <a accesskey="n" href="quickstart.html">Next</a></td></tr></table><hr /></div><div class="section" title="32.5. Multiple Threads of Execution"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="mt"></a>32.5. Multiple Threads of Execution</h2></div><div><h3 class="subtitle"><span class="plat-dep">Platform Dependent: <span class="plat-dep">Only in <a class="ulink" href="http://clisp.cons.org" target="_top"><span class="command"><strong>CLISP</strong></span></a> built <span class="strong"><strong>with</strong></span>
  compile-time flag <code class="option">--with-threads</code>.</span></span></h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="mt.html#mt-intro">32.5.1. Introduction</a></span></dt><dt><span class="section"><a href="mt.html#mt-general">32.5.2. General principles</a></span></dt><dd><dl><dt><span class="section"><a href="mt.html#mt-parallelizability">32.5.2.1. Parallelizability</a></span></dt><dt><span class="section"><a href="mt.html#mt-symvalue">32.5.2.2. Special Variable Values</a></span></dt><dt><span class="section"><a href="mt.html#mt-package">32.5.2.3. Packages</a></span></dt><dt><span class="section"><a href="mt.html#mt-clos">32.5.2.4. <span class="command"><strong>CLOS</strong></span></a></span></dt><dt><span class="section"><a href="mt.html#mt-mutable">32.5.2.5. Hash Tables, Sequences, and other   mutable objects</a></span></dt><dt><span class="section"><a href="mt.html#mt-unsafe">32.5.2.6. Examples of thread-unsafe code</a></span></dt></dl></dd><dt><span class="section"><a href="mt.html#mt-api">32.5.3. Thread API reference</a></span></dt></dl></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>This functionality is
  <span class="strong"><strong>experimental</strong></span>.</p><p>Use it at your own risk.</p><p>Discuss it on <a class="" href="https://lists.sourceforge.net/lists/listinfo/clisp-devel">clisp-devel</a>.</p></div><div class="section" title="32.5.1. Introduction"><div class="titlepage"><div><div><h3 class="title"><a id="mt-intro"></a>32.5.1. Introduction</h3></div></div></div><p><a class="ulink" href="http://clisp.cons.org" target="_top"><span class="command"><strong>CLISP</strong></span></a> uses the OS threads to implement multiple threads of execution.
 Two flavors are supported: <a class="ulink" href="http://www.opengroup.org/austin/papers/posix_faq.html" target="_top"><span class="platform">POSIX</span></a> and <a class="ulink" href="http://winehq.org/" target="_top"><span class="platform">Win32</span></a>. Both are preemptive.</p><p>All symbols are exported from the package <a class="link" href="mt.html" title="32.5. Multiple Threads of Execution"><strong class="package"><span class="quote">“<span class="quote">THREADS</span>”</span></strong></a>, which has nicknames
 <strong class="package"><span class="quote">“<span class="quote">MT</span>”</span></strong> (for <span class="emphasis"><em>MultiThreading</em></span>) and
 <strong class="package"><span class="quote">“<span class="quote">MP</span>”</span></strong> (for <span class="emphasis"><em>MultiProcessing</em></span>).
 When this functionality is present, <a href="features.html" class="olink"><code class="varname">*FEATURES*</code></a>
 contains the symbol <code class="constant">:MT</code>.</p><p>See also <a class="xref" href="gc-mt.html" title="35.7. Garbage Collection and Multithreading">Section 35.7, “Garbage Collection and Multithreading”</a>.</p></div><div class="section" title="32.5.2. General principles"><div class="titlepage"><div><div><h3 class="title"><a id="mt-general"></a>32.5.2. General principles</h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="mt.html#mt-parallelizability">32.5.2.1. Parallelizability</a></span></dt><dt><span class="section"><a href="mt.html#mt-symvalue">32.5.2.2. Special Variable Values</a></span></dt><dt><span class="section"><a href="mt.html#mt-package">32.5.2.3. Packages</a></span></dt><dt><span class="section"><a href="mt.html#mt-clos">32.5.2.4. <span class="command"><strong>CLOS</strong></span></a></span></dt><dt><span class="section"><a href="mt.html#mt-mutable">32.5.2.5. Hash Tables, Sequences, and other   mutable objects</a></span></dt><dt><span class="section"><a href="mt.html#mt-unsafe">32.5.2.6. Examples of thread-unsafe code</a></span></dt></dl></div><div class="section" title="32.5.2.1. Parallelizability"><div class="titlepage"><div><div><h4 class="title"><a id="mt-parallelizability"></a>32.5.2.1. Parallelizability</h4></div></div></div><p>A program developed for a single-threaded world which shares no
 application objects with programs running in other threads must run
 fine, without problems.</p><p>Specfically:
 if, in a single-threaded world, execution of program A before program B
 produces semantically the same results as execution of program B before
 program A, then in a multithreaded world, it is possible to run A and B
 simultaneously in different threads, and the result will be the same as
 in the two single-threaded cases (A before B, or B before A).
 </p><div class="itemizedlist" title="Summary"><p class="title"><b>Summary</b></p><ul class="itemizedlist" type="disc"><li class="listitem">If A and B have no common objects, then the
    implementation ensures that the principle is fulfilled.</li><li class="listitem">If A and B share some objects, the implementation
    allows the programs to satisfy the principle with little effort.
</li></ul></div></div><div class="section" title="32.5.2.2. Special Variable Values"><div class="titlepage"><div><div><h4 class="title"><a id="mt-symvalue"></a>32.5.2.2. Special Variable Values</h4></div></div></div><p>Every <a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-1-2-1-1-2.html">dynamic variable</a> has a global value that can be shared across all
 <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a>s.</p><p>Bindings of <a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-1-2-1-1-2.html">dynamic variable</a>s (via <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/speope_letcm_letst.html" target="_top"><code class="function">LET</code></a>/<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/speope_letcm_letst.html" target="_top"><code class="function">LET*</code></a>/<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_multiple-value-bind.html" target="_top"><code class="function">MULTIPLE-VALUE-BIND</code></a>)
 are local to <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a>s, i.e. every <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_symbol.html" target="_top"><code class="classname">SYMBOL</code></a> has a different value cell in
 each <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a>.  <a class="link" href="mt.html#symbol-value-thread"><code class="function">MT:SYMBOL-VALUE-THREAD</code></a> can be used to inspect and modify
 these thread local bindings.</p><p>Threads do not inherit dynamic bindings from the parent thread.</p><p>Example:</p><pre class="programlisting">
(defvar *global* 1)<strong>	; </strong><em class="lineannotation"><span class="lineannotation">create a <a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Global Variable</em></span></a></span></em>
(defun thread-1 ()
   <strong>	; </strong><em class="lineannotation"><span class="lineannotation">here *global* and (<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/acc_symbol-value.html" target="_top"><code class="function">SYMBOL-VALUE</code></a> *global*) will be 1 not 2!</span></em>
  (setq *global* 5)<strong>	; </strong><em class="lineannotation"><span class="lineannotation">change the <a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Global Variable</em></span></a> value</span></em>
  (let ((*global* 10))<strong>	; </strong><em class="lineannotation"><span class="lineannotation"><a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Per-Thread Variable</em></span></a> value is initialized</span></em>
    (setq *global* 20)<strong>	; </strong><em class="lineannotation"><span class="lineannotation"><a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Per-Thread Variable</em></span></a> value is changed</span></em>
    <strong>	; </strong><em class="lineannotation"><span class="lineannotation"><a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Global Variable</em></span></a> value is not accessible here (only via <a class="link" href="mt.html#symbol-value-thread"><code class="function">MT:SYMBOL-VALUE-THREAD</code></a>)</span></em>
    )
  (setq *global* 30))<strong>	; </strong><em class="lineannotation"><span class="lineannotation"><a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Global Variable</em></span></a> value is modified again</span></em>
(let ((*global* 2))<strong>	; </strong><em class="lineannotation"><span class="lineannotation"><a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Per-Thread Variable</em></span></a> value is initialized</span></em>
  (<a class="link" href="mt.html#make-thread"><code class="function">MT:MAKE-THREAD</code></a> #'thread-1))
</pre></div><div class="section" title="32.5.2.3. Packages"><div class="titlepage"><div><div><h4 class="title"><a id="mt-package"></a>32.5.2.3. Packages</h4></div><div><h5 class="subtitle">This information is likely to change in the near future</h5></div></div></div><p><a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_package.html" target="_top"><code class="classname">PACKAGE</code></a> objects have an internal mutex and are locked by
 <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_intern.html" target="_top"><code class="function">INTERN</code></a> before adding a symbol (if <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_find-symbol.html" target="_top"><code class="function">FIND-SYMBOL</code></a> fails).  All
 modifications of internal package data are guarded by this mutex.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Currently there is one exception: <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_use-package.html" target="_top"><code class="function">USE-PACKAGE</code></a> is not
  protected and thus not thread safe.</p></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Symbol look-up within package currently is not guarded!
  This means that in certain cases <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_find-symbol.html" target="_top"><code class="function">FIND-SYMBOL</code></a> may return <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> even
  though the symbol is accessible (this may happen when internal package
  hash tables are re-hashed at the time <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_find-symbol.html" target="_top"><code class="function">FIND-SYMBOL</code></a> performs look-up).
</p></div><p>One crucial implication is that one <span class="emphasis"><em>cannot</em></span>
 call <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_load.html" target="_top"><code class="function">LOAD</code></a> from different threads at the same time.</p><p>See also <a class="xref" href="mt.html#mt-clos" title="32.5.2.4. CLOS">Section 32.5.2.4, “<span class="command"><strong>CLOS</strong></span>”</a>.</p></div><div class="section" title="32.5.2.4. CLOS"><div class="titlepage"><div><div><h4 class="title"><a id="mt-clos"></a>32.5.2.4. <a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/chap-7.html"><span class="command"><strong>CLOS</strong></span></a></h4></div><div><h5 class="subtitle">This information is likely to change in the near future</h5></div></div></div><p><a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/chap-7.html"><span class="command"><strong>CLOS</strong></span></a> is <span class="strong"><strong>not</strong></span> thread-safe. <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_defclass.html" target="_top"><code class="function">DEFCLASS</code></a>, <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_defgeneric.html" target="_top"><code class="function">DEFGENERIC</code></a>,
 <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_defmethod.html" target="_top"><code class="function">DEFMETHOD</code></a>, <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_defstruct.html" target="_top"><code class="function">DEFSTRUCT</code></a> modify <a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/chap-7.html"><span class="command"><strong>CLOS</strong></span></a> without any locking and may
 interfere with each other.</p><p>It is recommended that all code is <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_load.html" target="_top"><code class="function">LOAD</code></a>ed <span class="strong"><strong>before</strong></span>
 any <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a>s are spawned.</p><p>See also <a class="xref" href="mt.html#mt-package" title="32.5.2.3. Packages">Section 32.5.2.3, “Packages”</a>.</p></div><div class="section" title="32.5.2.5. Hash Tables, Sequences, and other mutable objects"><div class="titlepage"><div><div><h4 class="title"><a id="mt-mutable"></a>32.5.2.5. Hash Tables, Sequences, and other
  mutable objects</h4></div><div><h5 class="subtitle">If you want to shoot yourself, it is <span class="emphasis"><em>your</em></span>
 responsibility to wear armor.</h5></div></div></div><p>Nothing is ever locked automatically (automatic locking will
 impose an unjustifiable penalty on <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_hash-table.html" target="_top"><code class="classname">HASH-TABLE</code></a>s and <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_sequence.html" target="_top"><code class="classname">SEQUENCE</code></a>s
 local to threads), so the user must use locks when sharing
 <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_hash-table.html" target="_top"><code class="classname">HASH-TABLE</code></a>s, <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_sequence.html" target="_top"><code class="classname">SEQUENCE</code></a>s and user-defined mutable objects between
 threads.</p><p>This approach is consistent with the usual <a class="ulink" href="http://www.lisp.org" target="_top"><span class="command"><strong>Common Lisp</strong></span></a> approach:
 </p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>The consequences are undefined when code executed during an
   object-traversing operation destructively modifies the object in a
   way that might affect the ongoing traversal operation...
 </p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution"><a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-6.html">[sec_3-6]</a></span></td></tr></table></div><p>
 </p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>If an object O1 is used as a key in a hash table H and is then
   visibly modified with regard to the equivalence test of H, then the
   consequences are unspecified if O1 is used as a key in further
   operations on H...</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution"><a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_18-1-2.html">[sec_18-1-2]</a></span></td></tr></table></div></div><div class="section" title="32.5.2.6. Examples of thread-unsafe code"><div class="titlepage"><div><div><h4 class="title"><a id="mt-unsafe"></a>32.5.2.6. Examples of thread-unsafe code</h4></div></div></div><p>Here are some forms whose results are undefined if two threads
 evaluate them without locking:</p><pre class="programlisting">
(<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_incfcm_decf.html" target="_top"><code class="function">INCF</code></a> (<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/acc_gethash.html" target="_top"><code class="function">GETHASH</code></a> x global-ht 0))<strong>	; </strong><em class="lineannotation"><span class="lineannotation">see <a class="xref" href="mt.html#mt-mutable" title="32.5.2.5. Hash Tables, Sequences, and other mutable objects">Section 32.5.2.5, “Hash Tables, Sequences, and other   mutable objects”</a></span></em>
(<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a> (<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/acc_aref.html" target="_top"><code class="function">AREF</code></a> global-array ...) ...)<strong>	; </strong><em class="lineannotation"><span class="lineannotation">ditto</span></em>
(<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_defmethod.html" target="_top"><code class="function">DEFMETHOD</code></a> <em class="replaceable"><code>generic-function</code></em> (...) ...)<strong>	; </strong><em class="lineannotation"><span class="lineannotation">see <a class="xref" href="mt.html#mt-clos" title="32.5.2.4. CLOS">Section 32.5.2.4, “<span class="command"><strong>CLOS</strong></span>”</a></span></em>
(<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_load.html" target="_top"><code class="function">LOAD</code></a> <em class="replaceable"><code>filename</code></em>)<strong>	; </strong><em class="lineannotation"><span class="lineannotation">see <a class="xref" href="mt.html#mt-package" title="32.5.2.3. Packages">Section 32.5.2.3, “Packages”</a></span></em>
(<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_read-from-string.html" target="_top"><code class="function">READ-FROM-STRING</code></a> <em class="replaceable"><code>string</code></em>)<strong>	; </strong><em class="lineannotation"><span class="lineannotation">ditto</span></em>
</pre></div></div><div class="section" title="32.5.3. Thread API reference"><div class="titlepage"><div><div><h3 class="title"><a id="mt-api"></a>32.5.3. Thread API reference</h3></div></div></div><div class="variablelist"><dl><dt><a id="thread"></a><span class="term"><a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a></span></dt><dd><p class="simpara">The type of the object returned by <a class="link" href="mt.html#make-thread"><code class="function">MT:MAKE-THREAD</code></a>.</p><p class="simpara">Each <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a> represent a separate computation, executed in
   parallel to each other.</p></dd><dt><a id="make-thread"></a><span class="term"><code class="code">(<a class="link" href="mt.html#make-thread"><code class="function">MT:MAKE-THREAD</code></a> <em class="replaceable"><code>function</code></em>
   <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a> <code class="constant">:NAME</code> :INITIAL-BINDINGS :CSTACK-SIZE :VSTACK-SIZE)</code></span></dt><dd><p class="simpara">Start a new named <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a> running <em class="replaceable"><code>function</code></em>.</p><div class="variablelist"><dl><dt><span class="term"><code class="constant">:INITIAL-BINDINGS</code></span></dt><dd>an <a class="" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/glo_a.html#association_list">association list</a> of <span class="data"><code class="literal">(<em class="replaceable"><code>symbol</code></em>
       . <em class="replaceable"><code>form</code></em>)</code></span>.
      The <em class="replaceable"><code>form</code></em>s are <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_eval.html" target="_top"><code class="function">EVAL</code></a>uated in the context of the new thread
      and <em class="replaceable"><code>symbol</code></em>s are bound to the result in the thread before <em class="replaceable"><code>function</code></em> is
      called. The default value is <a class="link" href="mt.html#default-special-bindings"><code class="varname">MT:*DEFAULT-SPECIAL-BINDINGS*</code></a>.
   </dd><dt><span class="term"><code class="constant">:CSTACK-SIZE</code></span></dt><dd>the size in bytes of the control (<a class="ulink" href="http://c-faq.com/" target="_top"><span class="command"><strong>C</strong></span></a>) stack.
      If 0, the value is decided by the OS.</dd><dt><span class="term"><code class="constant">:VSTACK-SIZE</code></span></dt><dd>the size of the <a class="ulink" href="http://clisp.cons.org" target="_top"><span class="command"><strong>CLISP</strong></span></a> <a href="vm.html" class="olink"><code class="literal">STACK</code></a> in <a class="link" href="typecodes.html" title="35.3. Object Pointer Representations"><span class="type">object</span></a>s.
     The default value is calculated based on the <code class="option"><a href="clisp.html#opt-memsize" class="olink">-m</a></code> option
     used when <a class="ulink" href="http://clisp.cons.org" target="_top"><span class="command"><strong>CLISP</strong></span></a> was started.
     If 0, the value will be the same as that of the calling thread.
  </dd></dl></div><p class="simpara">If <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a> creation fails (e.g., due to a lack of system
   memory), a <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/contyp_control-error.html" target="_top"><code class="classname">CONTROL-ERROR</code></a> is <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a>ed.</p><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/pthread_create.html"><code class="function">pthread_create</code></a>.</p></dd><dt><a id="threadp"></a><span class="term"><code class="code">(<a class="link" href="mt.html#threadp"><code class="function">MT:THREADP</code></a> <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>Check whether the object is of type <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a>.
</dd><dt><a id="thread-yield"></a><span class="term"><code class="code">(<a class="link" href="mt.html#thread-yield"><code class="function">MT:THREAD-YIELD</code></a> <em class="replaceable"><code>thread</code></em>)</code></span></dt><dd><p class="simpara">Relinquish the CPU.  The <em class="replaceable"><code>thread</code></em> is placed at the end
   of the run queue and another thread is scheduled to run.</p><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/sched_yield.html"><code class="function">sched_yield</code></a>.</p></dd><dt><a id="thread-interrupt"></a><span class="term"><code class="code">(<a class="link" href="mt.html#thread-interrupt"><code class="function">MT:THREAD-INTERRUPT</code></a> <em class="replaceable"><code>thread</code></em>
   <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a> <code class="constant">:FUNCTION</code> <code class="constant">:OVERRIDE</code> <code class="constant">:ARGUMENTS</code>)</code></span></dt><dd><p class="simpara">Interrupt the normal execution flow in <em class="replaceable"><code>thread</code></em> and ask
   it to <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_apply.html" target="_top"><code class="function">APPLY</code></a> <em class="replaceable"><code>function</code></em> to <em class="replaceable"><code>arguments</code></em>.</p><p class="simpara">Use <code class="code">(<a class="link" href="mt.html#thread-interrupt"><code class="function">MT:THREAD-INTERRUPT</code></a> <em class="replaceable"><code>thread</code></em> <code class="constant">:FUNCTION</code> <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>)</code>
   to debug <em class="replaceable"><code>thread</code></em> and <code class="code">(<a class="link" href="mt.html#thread-interrupt"><code class="function">MT:THREAD-INTERRUPT</code></a> <em class="replaceable"><code>thread</code></em> <code class="constant">:FUNCTION</code>
    <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>)</code> to terminate <em class="replaceable"><code>thread</code></em>.</p><p class="simpara">The <code class="constant">:OVERRIDE</code> argument overrides <a class="link" href="mt.html#with-deferred-interrupts"><code class="function">MT:WITH-DEFERRED-INTERRUPTS</code></a>
   and should be used with extreme care.</p><p class="simpara">Threads can only be interrupted at a point where the <a href="gc.html" class="olink">garbage-collect</a>ion
   can run, see <a class="xref" href="gc-mt.html" title="35.7. Garbage Collection and Multithreading">Section 35.7, “Garbage Collection and Multithreading”</a>.</p><p class="simpara">Currently on <a class="ulink" href="http://winehq.org/" target="_top"><span class="platform">Win32</span></a> blocking I/O cannot be interrupted.
   The interrupt will be handled after the call returns.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Thread may be interrupted inside <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/speope_unwind-protect.html" target="_top"><code class="function">UNWIND-PROTECT</code></a>'s
    cleanup forms and on non-local exit from <em class="replaceable"><code>function</code></em> -
    they may not execute entirely.  In order to prevent this,
    <a class="link" href="mt.html#with-deferred-interrupts"><code class="function">MT:WITH-DEFERRED-INTERRUPTS</code></a> is provided.</p></div></dd><dt><a id="thread-name"></a><span class="term"><code class="code">(<a class="link" href="mt.html#thread-name"><code class="function">MT:THREAD-NAME</code></a> <em class="replaceable"><code>thread</code></em>)</code></span></dt><dd>Return the <em class="replaceable"><code>name</code></em> of the <em class="replaceable"><code>thread</code></em>.
</dd><dt><a id="thread-active-p"></a><span class="term"><code class="code">(<a class="link" href="mt.html#thread-active-p"><code class="function">MT:THREAD-ACTIVE-P</code></a>
   <em class="replaceable"><code>thread</code></em>)</code></span></dt><dd><p class="simpara">Return <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> if the thread has already terminated
   and <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> otherwise.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>By the time this function returns <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>, <em class="replaceable"><code>thread</code></em> may have
    already terminated anyway.</p></div></dd><dt><a id="current-thread"></a><span class="term"><code class="code">(<a class="link" href="mt.html#current-thread"><code class="function">MT:CURRENT-THREAD</code></a>)</code></span></dt><dd>Return the <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a> object encapsulating the caller.
</dd><dt><a id="list-threads"></a><span class="term"><code class="code">(<a class="link" href="mt.html#list-threads"><code class="function">MT:LIST-THREADS</code></a>)</code></span></dt><dd><p class="simpara">Return the <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_list.html" target="_top"><code class="classname">LIST</code></a> of all currently running <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a>s.
  </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>By the time this function returns, the set of
    actually running threads may have a single intersection with the
    return value - the <a class="link" href="mt.html#current-thread"><code class="function">MT:CURRENT-THREAD</code></a>.
</p></div></dd><dt><a id="mutex"></a><span class="term"><a class="link" href="mt.html#mutex"><span class="type">MT:MUTEX</span></a></span></dt><dd><p class="simpara">The type of the object return by <a class="link" href="mt.html#make-mutex"><code class="function">MT:MAKE-MUTEX</code></a>.</p><p class="simpara">This represents a <span class="emphasis"><em>lock</em></span>, i.e., a way to
   prevent different threads from doing something at the same time,
   e.g., modifying the same object.</p></dd><dt><a id="mutexp"></a><span class="term"><code class="code">(<a class="link" href="mt.html#mutexp"><code class="function">MT:MUTEXP</code></a> <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>Check whether the object is of type <a class="link" href="mt.html#mutex"><span class="type">MT:MUTEX</span></a>.
</dd><dt><a id="make-mutex"></a><span class="term"><code class="code">(<a class="link" href="mt.html#make-mutex"><code class="function">MT:MAKE-MUTEX</code></a> <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a>
   <code class="constant">:NAME</code> <code class="constant">:RECURSIVE-P</code>)</code></span></dt><dd><p class="simpara">Create new <a class="link" href="mt.html#mutex"><span class="type">MT:MUTEX</span></a> object - not locked by any thread.
   <code class="constant">:NAME</code> should be a <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a> describing the mutex (this really helps
   debugging deadlocks).  When <em class="replaceable"><code>RECURSIVE-P</code></em> is
   non-<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, a recursive <a class="link" href="mt.html#mutex"><span class="type">MT:MUTEX</span></a> is created i.e., a thread can acquire
   the mutex repeatedly (and should, of course, release it for each
   successful acquisition).</p><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/pthread_mutex_init.html"><code class="function">pthread_mutex_init</code></a>.</p></dd><dt><a id="mutex-name"></a><span class="term"><code class="code">(<a class="link" href="mt.html#mutex-name"><code class="function">MT:MUTEX-NAME</code></a> <em class="replaceable"><code>thread</code></em>)</code></span></dt><dd>Return the <em class="replaceable"><code>name</code></em> of the <a class="link" href="mt.html#mutex"><span class="type">MT:MUTEX</span></a>.
</dd><dt><a id="mutex-lock"></a><span class="term"><code class="code">(<a class="link" href="mt.html#mutex-lock"><code class="function">MT:MUTEX-LOCK</code></a> <em class="replaceable"><code>mutex</code></em>
   <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a> <a class="link" href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a>)</code></span></dt><dd><p class="simpara">Acquire the <em class="replaceable"><code>mutex</code></em>.  If <em class="replaceable"><code>mutex</code></em> is locked by
   another thread, the call blocks and waits up to <a class="link" href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a> <a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_25-1-4-4.html">seconds</a>.
   If <a class="link" href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a> is not specified, waits forever.</p><p class="simpara">Return <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> on a successful locking of <em class="replaceable"><code>mutex</code></em>, and <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> on
   timeout.</p><p>If the calling thread has already acquired <em class="replaceable"><code>mutex</code></em>, then
   </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">if <em class="replaceable"><code>mutex</code></em> is recursive, <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> is
      returned (for each recursive <a class="link" href="mt.html#mutex-lock"><code class="function">MT:MUTEX-LOCK</code></a> there should be a
      separate <a class="link" href="mt.html#mutex-unlock"><code class="function">MT:MUTEX-UNLOCK</code></a>);</li><li class="listitem">If <em class="replaceable"><code>mutex</code></em> is non-recursive an <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a> is <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a>ed to
      avoid a deadlock.</li></ul></div><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/pthread_mutex_lock.html"><code class="function">pthread_mutex_lock</code></a>.</p></dd><dt><a id="mutex-unlock"></a><span class="term"><code class="code">(<a class="link" href="mt.html#mutex-unlock"><code class="function">MT:MUTEX-UNLOCK</code></a>
   <em class="replaceable"><code>mutex</code></em>)</code></span></dt><dd><p class="simpara">Release (unlock) <em class="replaceable"><code>mutex</code></em>. If the calling thread is
   not locking <em class="replaceable"><code>mutex</code></em>, an <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a> is <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a>ed.</p><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/pthread_mutex_unlock.html"><code class="function">pthread_mutex_unlock</code></a>.</p></dd><dt><a id="mutex-owner"></a><span class="term"><code class="code">(<a class="link" href="mt.html#mutex-owner"><code class="function">MT:MUTEX-OWNER</code></a>
   <em class="replaceable"><code>mutex</code></em>)</code></span></dt><dd><p class="simpara">Return the <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a> that owns (locks) <em class="replaceable"><code>mutex</code></em>,
   or <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> if <em class="replaceable"><code>mutex</code></em> is not locked.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>By the time this function returns the <em class="replaceable"><code>mutex</code></em>
    ownership may have changed (unless the owner is the
    <a class="link" href="mt.html#current-thread"><code class="function">MT:CURRENT-THREAD</code></a>). The function is mostly useful for debugging
    deadlocks.</p></div></dd><dt><a id="mutex-recursive-p"></a><span class="term"><code class="code">(<a class="link" href="mt.html#mutex-recursive-p"><code class="function">MT:MUTEX-RECURSIVE-P</code></a>
   <em class="replaceable"><code>mutex</code></em>)</code></span></dt><dd>Return a indicator whether <em class="replaceable"><code>mutex</code></em> is recursive.
</dd><dt><a id="with-lock"></a><span class="term"><code class="code">(<a class="link" href="mt.html#with-lock"><code class="function">MT:WITH-LOCK</code></a> (<em class="replaceable"><code>mutex</code></em>)
   <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-4.html" target="_top"><code class="literal">&amp;BODY</code></a> <em class="replaceable"><code>body</code></em>)</code></span></dt><dd>Execute <em class="replaceable"><code>body</code></em> with <em class="replaceable"><code>mutex</code></em> locked.
   Upon exit <em class="replaceable"><code>mutex</code></em> is released. Return whatever <em class="replaceable"><code>body</code></em> returns.
</dd><dt><a id="exemption"></a><span class="term"><a class="link" href="mt.html#exemption"><span class="type">MT:EXEMPTION</span></a></span></dt><dd><p class="simpara">The type of the object returned by <a class="link" href="mt.html#make-exemption"><code class="function">MT:MAKE-EXEMPTION</code></a>.
   These correspond to the <a class="ulink" href="http://www.opengroup.org/austin/papers/posix_faq.html" target="_top"><span class="platform">POSIX</span></a> condition variables,
   see <a class="unix" href="http://www.opengroup.org/susv3/basedefs/pthread.h.html">&lt;<code class="filename">pthread.h</code>&gt;</a>.</p><p class="simpara">These objects allow broadcasting state from one <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a> to
   the others.</p></dd><dt><a id="exemptionp"></a><span class="term"><code class="code">(<a class="link" href="mt.html#exemptionp"><code class="function">MT:EXEMPTIONP</code></a>
   <em class="replaceable"><code>object</code></em>)</code></span></dt><dd>Check whether the object is of type <a class="link" href="mt.html#exemption"><span class="type">MT:EXEMPTION</span></a>.
</dd><dt><a id="make-exemption"></a><span class="term"><code class="code">(<a class="link" href="mt.html#make-exemption"><code class="function">MT:MAKE-EXEMPTION</code></a>
   <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a> <code class="constant">:NAME</code>)</code></span></dt><dd><p class="simpara">Create a new <a class="link" href="mt.html#exemption"><span class="type">MT:EXEMPTION</span></a> object.
   <code class="constant">:NAME</code> should be a <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_string.html" target="_top"><code class="classname">STRING</code></a> describing the exemption (this really
   helps debugging deadlocks).</p><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/pthread_cond_init.html"><code class="function">pthread_cond_init</code></a>.</p></dd><dt><a id="exemption-name"></a><span class="term"><code class="code">(<a class="link" href="mt.html#exemption-name"><code class="function">MT:EXEMPTION-NAME</code></a>
   <em class="replaceable"><code>thread</code></em>)</code></span></dt><dd>Return the <em class="replaceable"><code>name</code></em> of the <em class="replaceable"><code>exemption</code></em>.
</dd><dt><a id="exemption-signal"></a><span class="term"><code class="code">(<a class="link" href="mt.html#exemption-signal"><code class="function">MT:EXEMPTION-SIGNAL</code></a>
   <em class="replaceable"><code>exemption</code></em>)</code></span></dt><dd><p class="simpara">Signal <em class="replaceable"><code>exemption</code></em> object, i.e. wake up a thread blocked
   on waiting for <em class="replaceable"><code>exemption</code></em>.</p><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/pthread_cond_signal.html"><code class="function">pthread_cond_signal</code></a>.</p></dd><dt><a id="exemption-wait"></a><span class="term"><code class="code">(<a class="link" href="mt.html#exemption-wait"><code class="function">MT:EXEMPTION-WAIT</code></a>
   <em class="replaceable"><code>exemption</code></em> <em class="replaceable"><code>mutex</code></em> <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;KEY</code></a> <a class="link" href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a>)</code></span></dt><dd><p class="simpara">Wait for another <a class="link" href="mt.html#thread"><span class="type">MT:THREAD</span></a> to call <a class="link" href="mt.html#exemption-signal"><code class="function">MT:EXEMPTION-SIGNAL</code></a>
   or <a class="link" href="mt.html#exemption-broadcast"><code class="function">MT:EXEMPTION-BROADCAST</code></a> on <em class="replaceable"><code>exemption</code></em>.
   <em class="replaceable"><code>mutex</code></em> should be locked by the caller; otherwise an <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/contyp_error.html" target="_top"><code class="classname">ERROR</code></a> is <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_signal.html" target="_top"><code class="function">SIGNAL</code></a>ed.
   The function releases the <em class="replaceable"><code>mutex</code></em> and waits for <em class="replaceable"><code>exemption</code></em>.
   On return <em class="replaceable"><code>mutex</code></em> is acquired again.</p><p class="simpara">The function waits up to <a class="link" href="socket.html#timeout-k"><code class="constant">:TIMEOUT</code></a> <a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_25-1-4-4.html">seconds</a>.
   If timeout is not specified, waits forever.</p><p class="simpara">
   Returns <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> if <em class="replaceable"><code>exemption</code></em> was signaled and <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> on timeout.</p><p>On <a class="ulink" href="http://www.opengroup.org/austin/papers/posix_faq.html" target="_top"><span class="platform">POSIX</span></a> it is possible to have
   <a class="ulink" href="http://en.wikipedia.org/wiki/Spurious_wakeup" target="_top">spurious
    wakeup</a>s, i.e., this function may return <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> even though no
   thread called <a class="link" href="mt.html#exemption-broadcast"><code class="function">MT:EXEMPTION-BROADCAST</code></a> or <a class="link" href="mt.html#exemption-signal"><code class="function">MT:EXEMPTION-SIGNAL</code></a>.
   Therefore, a common idiom for using this function is <code class="code">(<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_loop.html" target="_top"><code class="function">LOOP</code></a>
    :while (some-condition-is-satisfied) :do (<a class="link" href="mt.html#exemption-wait"><code class="function">MT:EXEMPTION-WAIT</code></a> <em class="replaceable"><code>exemption</code></em>
    <em class="replaceable"><code>mutex</code></em>))</code>.</p><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/pthread_cond_wait.html"><code class="function">pthread_cond_wait</code></a>.</p></dd><dt><a id="exemption-broadcast"></a><span class="term"><code class="code">(<a class="link" href="mt.html#exemption-broadcast"><code class="function">MT:EXEMPTION-BROADCAST</code></a>
   <em class="replaceable"><code>exemption</code></em>)</code></span></dt><dd><p class="simpara">Signal <em class="replaceable"><code>exemption</code></em> to all threads waiting for it.</p><p class="simpara">Cf. <a class="unix" href="http://www.opengroup.org/susv3/functions/pthread_cond_broadcast.html"><code class="function">pthread_cond_broadcast</code></a>.
</p></dd><dt><a id="y-or-n-p-timeout"></a><span class="term"><code class="code">(<a class="link" href="mt.html#y-or-n-p-timeout"><code class="function">MT:Y-OR-N-P-TIMEOUT</code></a>
   seconds default <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;REST</code></a> <em class="replaceable"><code>arguments</code></em>)</code><br /></span><span class="term"><code class="code">(<a class="link" href="mt.html#y-or-n-p-timeout"><code class="function">MT:YES-OR-NO-P-TIMEOUT</code></a> seconds default <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-1.html" target="_top"><code class="literal">&amp;REST</code></a>
   <em class="replaceable"><code>arguments</code></em>)</code></span></dt><dd>Similar to <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_y-or-n-pcm_yes-or-no-p.html" target="_top"><code class="function">Y-OR-N-P</code></a> and <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_y-or-n-pcm_yes-or-no-p.html" target="_top"><code class="function">YES-OR-NO-P</code></a>, but use
   <a class="link" href="mt.html#with-timeout"><code class="function">MT:WITH-TIMEOUT</code></a> to return <em class="replaceable"><code>DEFAULT</code></em> when no
   reply is given within timeout <a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_25-1-4-4.html">seconds</a>.</dd><dt><a id="with-timeout"></a><span class="term"><code class="code">(<a class="link" href="mt.html#with-timeout"><code class="function">MT:WITH-TIMEOUT</code></a>
   (seconds <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-4.html" target="_top"><code class="literal">&amp;BODY</code></a> timeout-forms) <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-4.html" target="_top"><code class="literal">&amp;BODY</code></a> <em class="replaceable"><code>body</code></em>)</code></span></dt><dd><p class="simpara">Execute <em class="replaceable"><code>body</code></em>. If it does not finish for up to
   <a class="clhs" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_25-1-4-4.html">seconds</a>, it is interrupted and <em class="replaceable"><code>timeout-forms</code></em>
   are executed.</p><p class="simpara">Return the values of the last evaluated form in either
   <em class="replaceable"><code>body</code></em> or <em class="replaceable"><code>timeout-forms</code></em>.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Since on timeout the current thread is interrupted,
    special care may be needed for ensuring proper cleanup in <em class="replaceable"><code>body</code></em>.
    See <a class="link" href="mt.html#thread-interrupt"><code class="function">MT:THREAD-INTERRUPT</code></a> and <a class="link" href="mt.html#with-deferred-interrupts"><code class="function">MT:WITH-DEFERRED-INTERRUPTS</code></a>.</p></div></dd><dt><a id="symbol-value-thread"></a><span class="term"><code class="code">(<a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/mac_setfcm_psetf.html" target="_top"><code class="function">SETF</code></a>
   (<a class="link" href="mt.html#symbol-value-thread"><code class="function">MT:SYMBOL-VALUE-THREAD</code></a> <em class="replaceable"><code>symbol</code></em> <em class="replaceable"><code>thread</code></em>) <em class="replaceable"><code>value</code></em>)</code><br /></span><span class="term"><code class="code">(<a class="link" href="mt.html#symbol-value-thread"><code class="function">MT:SYMBOL-VALUE-THREAD</code></a> <em class="replaceable"><code>symbol</code></em> <em class="replaceable"><code>thread</code></em>)</code></span></dt><dd>Access or set the <a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Per-Thread Variable</em></span></a> value.
   When <em class="replaceable"><code>thread</code></em> is <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a>, use the <a class="link" href="mt.html#current-thread"><code class="function">MT:CURRENT-THREAD</code></a>; if it is <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a>, use the
   <a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Global Variable</em></span></a> binding.
   Returns two values: the <em class="replaceable"><code>symbol</code></em> binding and an indicator: <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_nil.html" target="_top"><code class="constant">NIL</code></a> if
   not bound in the <em class="replaceable"><code>thread</code></em>, <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/convar_t.html" target="_top"><code class="constant">T</code></a> if bound, and <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/syscla_symbol.html" target="_top"><code class="classname">SYMBOL</code></a> <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_makunbound.html" target="_top"><code class="function">MAKUNBOUND</code></a> if
   the <a class="link" href="mt.html#mt-symvalue" title="32.5.2.2. Special Variable Values"><span class="emphasis"><em>Per-Thread Variable</em></span></a> binding was removed with <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/fun_makunbound.html" target="_top"><code class="function">MAKUNBOUND</code></a>.
</dd><dt><a id="default-special-bindings"></a><span class="term"><a class="link" href="mt.html#default-special-bindings"><code class="varname">MT:*DEFAULT-SPECIAL-BINDINGS*</code></a></span></dt><dd>The default <code class="constant">:INITIAL-BINDINGS</code>
   argument of <a class="link" href="mt.html#make-thread"><code class="function">MT:MAKE-THREAD</code></a>.</dd><dt><a id="with-deferred-interrupts"></a><span class="term">
  <code class="code">(<a class="link" href="mt.html#with-deferred-interrupts"><code class="function">MT:WITH-DEFERRED-INTERRUPTS</code></a> <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/sec_3-4-4.html" target="_top"><code class="literal">&amp;BODY</code></a> <em class="replaceable"><code>body</code></em>)</code></span></dt><dd><p class="simpara">Defer thread interrupts (but <span class="strong"><strong>not</strong></span> thread
   preemption) while <em class="replaceable"><code>body</code></em> is executed.  If there is an interrupt
   while <em class="replaceable"><code>body</code></em> is run, it is queued and will be executed after
   <em class="replaceable"><code>body</code></em> finishes.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>Care is needed if waiting or blocking in <em class="replaceable"><code>body</code></em>,
    since there is no way to interrupt it (in case of a deadlock).
    The macro was added to avoid partial <a class="ulink" href="http://www.ai.mit.edu/projects/iiip/doc/CommonLISP/HyperSpec/Body/speope_unwind-protect.html" target="_top"><code class="function">UNWIND-PROTECT</code></a>'s cleanup
    forms evaluation in case they are interrupted with a non-local exit.
</p></div></dd></dl></div></div></div><div class="bookinfo"><hr /><table width="100%" summary="impnotes meta info"><th><td align="left">These notes document <a class="ulink" href="http://clisp.cons.org" target="_top"><span class="command"><strong>CLISP</strong></span></a> version 2.48</td><td align="right">Last modified: 2009-07-28</td></th></table></div><div class="custom-footer"><hr /><table width="100%"><tr><td align="left"><a href="http://clisp.cons.org"><img src="clisp.png" width="48" height="48" alt="[CLISP home]" /></a></td><td align="center"><a href="https://sourceforge.net/donate/index.php?group_id=1355"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" alt="[Support CLISP]" /></a></td><td align="right"><a href="https://sourceforge.net/projects/clisp"><img width="120" height="30" alt="[SourceForge]" src="http://sflogo.sourceforge.net/sflogo.php?group_id=1355&amp;type=12&amp;page=mt" /></a></td></tr></table></div><hr /><form method="get" action="http://www.google.com/custom" target="_top"><table width="100%" border="0"><tr><td nowrap="nowrap" align="center"><input type="hidden" name="domains" value="clisp.cons.org;clisp.podval.org;www.lisp.org" /><label for="sbi" style="display: none">Enter your search terms</label><input type="text" name="q" size="50" maxlength="255" id="sbi" value="32.5. Multiple Threads of Execution" /><label for="sbb" style="display: none">Submit search form</label><input type="submit" name="sa" value="Google Search" id="sbb" /></td></tr><tr><td nowrap="nowrap" align="center"><input type="radio" name="sitesearch" value="" checked="1" id="ss0" /><label for="ss0" title="Search the Web"><small>Web</small></label><input type="radio" name="sitesearch" value="clisp.cons.org" id="ss1" /><label for="ss1" title="Search clisp.cons.org"><small>clisp.cons.org</small></label><input type="radio" name="sitesearch" value="clisp.podval.org" id="ss2" /><label for="ss2" title="Search clisp.podval.org"><small>clisp.podval.org</small></label><input type="radio" name="sitesearch" value="www.lisp.org" id="ss3" /><label for="ss3" title="Search www.lisp.org"><small>www.lisp.org</small></label><input type="hidden" name="client" value="pub-4445255502750357" /><input type="hidden" name="forid" value="1" /><input type="hidden" name="ie" value="UTF-8" /><input type="hidden" name="oe" value="UTF-8" /><input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:000000;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:48;LW:48;L:http://clisp.cons.org/clisp.png;S:http://clisp.cons.org;FORID:1" /><input type="hidden" name="hl" value="en" /></td></tr></table></form><hr /><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="socket.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ext-platform.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="quickstart.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">32.4. Socket Streams </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 32.6. Quickstarting delivery with <span class="command"><strong>CLISP</strong></span></td></tr></table></div></body></html>
